<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Rota ve Waypoint Testi</title>
  <style>
    html, body, #map { margin:0; padding:0; height:100%; width:100%; }
  </style>
  <script
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDiGyfMbMq3iUzpYXpqicGUJf7d_TtnIvo&libraries=geometry&callback=initMap"
          async defer>
  </script>
</head>
<body>
<div id="map"></div>
<script>
  function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 36.896893, lng: 30.713324 },
      zoom: 11
    });

    fetch('/api/routes?after=2025-04-01')
            .then(res => res.json())
            .then(data => {
              Object.values(data).forEach(dr => {
                const route = dr.routes[0];
                let fullPath = [];

                // 1) Rota çizgisi
                route.legs.forEach(leg => {
                  leg.steps.forEach(step => {
                    const segment = google.maps.geometry.encoding
                            .decodePath(step.polyline.encodedPath);
                    fullPath = fullPath.concat(segment);
                  });
                });
                new google.maps.Polyline({ map, path: fullPath, strokeWeight: 4 });

                // 2) Her leg’in başındaki koordinata bir marker koy
                route.legs.forEach((leg, idx) => {
                  // Burada leg.steps[0].startLocation var
                  const pos = leg.steps[0].startLocation;
                  new google.maps.Marker({
                    position: { lat: pos.lat, lng: pos.lng },
                    map,
                    label: String(idx + 1)      // opsiyonel: durak numarası
                  });
                });
              });
            })
            .catch(err => console.error('Rota yüklerken hata:', err));
  }
</script>
</body>
</html>
